블루투스로 <-> 아두이노 양방향 제어하기
=============

창의공학 4팀 시나리오

제목
-------------
블루투스 통신을 이용한 스마트폰 알람 기능의 구현

동영상
-----------
https://youtu.be/KIqQKMcjX0w

요약
-------------
설정한 조도 이상의 값이 되면 피에조 스피커로 기상 알람이 울리고 블루투스 연결된 스마트폰 앱에서 알람을 종료한다    

서론
-------------
창의공학 아두이노 키트 부품 중 블루투스 모듈(HC-06), 피에조 스피커, 조도센서를 사용합니다 조도 센서로 측정한 밝기가 100 이상 일시 “일어나!”라는 문자를 스마트폰에 보내고
피에조 스피커에서 “떳다 떳다 비행기” 멜로디를 반복하는 알람이 울립니다.

사용자가 아두이노와 블루투스 연결된 스마트폰 앱에서 AlarmEnd 버튼을 누르면 스마트폰이“알람종료”를 아두이노에 보내고 조도가 100 이상 이라도 알람이 울리지 않게 됩니다.

알람을 다시 설정할 때는 스마트폰 앱에서 Alarm Reset 버튼을 누르는 것으로 설정이 가능합니다. 

본론
-------------
1. 부품 설명
* 블루투스 모듈(HC-06)

![image](https://user-images.githubusercontent.com/66579265/98436154-6e675a00-211c-11eb-865a-a85d8724f90b.png)

블루투스 모듈(HC-06)은 아두이노에서 시리얼 통신을 이용하여 데이터 값을 주고 받을 수 있는 모듈이며, 10미터 정도에서 무선으로 데이터를 보내거나 받을 수 있습니다.

* 피에조 스피커

![image](https://user-images.githubusercontent.com/66579265/98436356-0ca7ef80-211e-11eb-87ec-171316750d3c.png)

피에조 스피커는 압력을 가하면 전기를 발생시키는 압전효과(Piezoelectric Effect)를 역이용한 소자로, 압전 효과를 가진 압전 소자에 전기 신호를 주어 수축과 팽창을 반복적으로 수행해 소리를 내는 스피커입니다.

* 조도센서

![image](https://user-images.githubusercontent.com/66579265/98436374-234e4680-211e-11eb-90c0-dca27b819021.png)

조도센서는 빛이 많이 들어오면 저항이 작아지고, 반대로 적게 들어오면 저항이 커지는 성질의 황화 카드뮴을 사용한 소자입니다.

다음으로는 아두이노의 회로 사진입니다

2. 블루투스 관련 스케치 설명

#include <SoftwareSerial.h> : 헤더파일 SoftwareSerial.h을 포함합니다. 소프트웨어 시리얼을 시작하기 위한 라이브러리입니다.

SoftwareSerial Bt(10, 11)    : 시리얼 통신 이름을 'Bt'로 선언합니다. 이름은 변경이 가능합니다. 시리얼 통신 수신, 송신 핀을 선언합니다. 10Pin-TX(HC06),11Pin-RX(HC06). RX(Transit Data)는 받는 신호, TX(Receive Data)는 보내는 신호입니다. 아두이노의 RX는 블루투스의 TX에 연결하고 아두이노의 TX는 블루투스의 RX에 연결합니다.

if (Bt.available())           : 시리얼 통신으로 신호가 들어올 때 다음 명령을 실행시킨다.

m = Bt.readString()          : 문자열 m에 Bt로 저장된 값을 저장합니다.

Bt.print("일어나!!")          : 소프트웨어 직렬 포트의 전송 핀으로 데이터를 출력합니다.



3. 소스코드
* 아두이노 코드

      #include <SoftwareSerial.h>

         SoftwareSerial Bt(10, 11); //10Pin-TX(HC06),11Pin-RX(HC06)

        void setup() {

        Bt.begin(9600);

       pinMode(13, OUTPUT);

      Serial.begin(9600);

       }

      String m = "AlarmReset";

      void loop() {

      int a = analogRead(A0);

      Serial.println(a);
    
      delay(500);

      if(m.indexOf("AlarmReset")==0){

      if(a > 100) {
   
        Bt.print("일어나!!");
        
        m = "AlarmStart";
        
        delay(500);
        
        }  
    
      }



      if (Bt.available()) {

       m = Bt.readString();
  
        if(m.indexOf("AlarmEnd")==0) { 
  
         Bt.print("알람종료");
  
      Serial.print("Alaram End");
  
       m = "AlarmEnd";
  
       }
  
             }

         if(m.indexOf("AlarmStart")==0){

       tone(13, 659, 500);
       
       delay(600);
       
       tone(13, 587, 500);
       
       delay(600);
       
       tone(13, 523, 500);
       
      delay(600);
      
       tone(13, 587, 500);
       
      delay(600);
      
       tone(13, 659, 500);
       
       delay(600);
     
       tone(13, 659, 500);
       
       delay(600);
       
       tone(13, 659, 500);
       
         delay(600);
         
          }


        }

* 앱인벤터 블럭

![image](https://user-images.githubusercontent.com/66579265/98436484-fc444480-211e-11eb-9b1a-7fcaa4cc8ab3.png)

![image](https://user-images.githubusercontent.com/66579265/98436509-20a02100-211f-11eb-800d-ac8d32a01724.png)


4. 회로 사진

![image](https://user-images.githubusercontent.com/66579265/98436511-2f86d380-211f-11eb-820a-9c21755953c0.png)

결론
-------------
아두이노와 블루투스 통신을 이용해 스마트폰의 앱을 사용해서 아두이노를 제어하는 작업은
블루투스 모듈만 있다면 서버를 따로 만들 필요 없이 바로 연결하여 아두이노에 여러 센서나
부속품을 간단한 스마트폰 앱을 이용하여 제어할 수 있으며, 조도 센서를 이용한 밝기 측정을 통해 해가 뜰 때 창문으로부터 들어오는 빛에 의한 밝기 변화 혹은 실내의 조명이 켜짐으로부터 변화를 측정해 알림으로 사용할 수 있다는 것은 알림뿐만 아니라 사용하기에 따라서 센서를 통해 위험을 감지하고 알리는 경보기, 블루투스와 연결된 잃어버린 물건이 주변의 변화를 감지하고 소리를 내어 물건의 위치를 알 수 있는 등 변화를 감지하고 소리 정보로 알려준다는
하나의 원리로 부터 여러 가지 응용으로 뻗어 나갈 수 있는 가능성을 가지고 있습니다.


소감
--------------
20150187 하반석

이번 창의공학 팀프로젝트 아두이노 양방향 통신을 하면서 처음에는 이게 뭐지 하면서 머리가 아팠다. 허나 팀과 함께 과제를 진행하면서 알람제작을 하게 되었고, 기존의 지식과 통합을 해서 알람을 제작하는데 나에게는 복잡한 내용이었던 것 같다. 그 후 아두이노 코딩을 하는데 막히는 부분이 있었다. 내가 원한 것은 여러번 반복이 되어야 하는데 내 코딩은 한번만 작동한 것이었다. 그래서 뭔지 몰랐는데 팀장님의 도움을 받아 전역함수를 넣어 사용한 것이 문제가 되었고 해결이 되었다. 끝으로 채택되지는 않았지만 내가 제작한 것을 깃허브에 링크로 남긴다. 
https://github.com/BasicStoneHk/my-




참고자료
-------------

[ 1 ] [아두이노 강좌] 블루투스 모듈 HC-06 사용법 알아보기|작성자 에듀이노 오픈랩
https://blog.naver.com/PostView.nhn?blogId=eduino&logNo=221121406317

[ 2 ] 위키백과(2019). 황화카드뮴. 2020. 10. 30 검색,
https://ko.wikipedia.org/wiki/%ED%99%A9%ED%99%94_%EC%B9%B4%EB%93%9C%EB%AE%B4

[ 3 ] 네이버블로그(2019,), 피에조스피커, 2020.10.30 검색.
https://blog.naver.com/PostView.nhn?blogId=yulian&logNo=221748202220

[4] 심재창 ∙ 정윤주 ∙ 고주영 ∙ 이영학, 『한 번에 이해되는 아두이노』, 인피니티북스(2020), P224


   
